(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{3304:(e,t,s)=>{"use strict";s.d(t,{n:()=>n});var a=s(5959),r=s(9863);let n=(0,a.v)()((0,r.Zr)(e=>({user:null,token:null,isAuthenticated:!1,login:function(t,s){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];a?(localStorage.setItem("token",s),sessionStorage.removeItem("token")):(sessionStorage.setItem("token",s),localStorage.removeItem("token")),localStorage.setItem("user",JSON.stringify(t)),e({user:t,token:s,isAuthenticated:!0})},logout:()=>{localStorage.removeItem("token"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),e({user:null,token:null,isAuthenticated:!1})},updateUser:t=>{localStorage.setItem("user",JSON.stringify(t)),e({user:t})}}),{name:"auth-storage"}))},4392:(e,t,s)=>{"use strict";s.d(t,{P:()=>r});var a=s(7621);let r={createAppointment:async e=>(await a.A.post("/appointments",e)).data,getTodayQueue:async e=>(await a.A.get("/appointments/today",{params:{doctorId:e}})).data,updateAppointment:async(e,t)=>(await a.A.put("/appointments/".concat(e),t)).data}},6560:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(5155),r=s(2115),n=s(3304),o=s(4392),l=s(2544),d=s(6942),i=s(3611),c=s(7621);let m={createPatient:async e=>(await c.A.post("/patients",e)).data,searchPatients:async(e,t)=>(await c.A.get("/patients/search",{params:{query:e,doctorId:t}})).data};var u=s(2663);let x=i.Ikc({name:i.YjP().min(2,"Name must be at least 2 characters"),phone:i.YjP().min(11,"Invalid phone number"),age:i.YjP().transform(e=>parseInt(e,10)),gender:i.k5n(["male","female","other"]),address:i.YjP().optional()});function p(e){let{onSuccess:t}=e,{user:s}=(0,n.n)(),[o,i]=(0,r.useState)(!1),{register:c,handleSubmit:p,formState:{errors:g},reset:h}=(0,l.mN)({resolver:(0,d.u)(x)}),b=async e=>{try{i(!0);let a=(null==s?void 0:s.role)==="doctor"?s.id:null==s?void 0:s.doctorId;if(!a)return void u.Ay.error("Doctor association not found");let r={...e,doctorId:a,newPatientFee:500,oldPatientFee:300},n=await m.createPatient(r);u.Ay.success("Patient registered successfully!"),h(),t&&t(n.data)}catch(e){var a,r;u.Ay.error((null==(r=e.response)||null==(a=r.data)?void 0:a.message)||"Failed to register patient")}finally{i(!1)}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"New Patient Registration"}),(0,a.jsxs)("form",{onSubmit:p(b),className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),(0,a.jsx)("input",{...c("phone"),type:"text",placeholder:"017...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2"}),g.phone&&(0,a.jsx)("span",{className:"text-red-500 text-xs",children:String(g.phone.message)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),(0,a.jsx)("input",{...c("name"),type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2"}),g.name&&(0,a.jsx)("span",{className:"text-red-500 text-xs",children:String(g.name.message)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Age"}),(0,a.jsx)("input",{...c("age"),type:"number",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2"}),g.age&&(0,a.jsx)("span",{className:"text-red-500 text-xs",children:String(g.age.message)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),(0,a.jsxs)("select",{...c("gender"),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2",children:[(0,a.jsx)("option",{value:"male",children:"Male"}),(0,a.jsx)("option",{value:"female",children:"Female"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Address (Optional)"}),(0,a.jsx)("textarea",{...c("address"),rows:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2"})]}),(0,a.jsx)("button",{type:"submit",disabled:o,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400",children:o?"Registering...":"Register Patient"})]})]})}function g(e){let{onSelect:t}=e,{user:s}=(0,n.n)(),[o,l]=(0,r.useState)(""),[d,i]=(0,r.useState)([]),[c,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),h=async e=>{if(e.preventDefault(),o.trim()){x(!0),g(!0);try{let e=(null==s?void 0:s.role)==="doctor"?s.id:null==s?void 0:s.doctorId;if(!e)return void u.Ay.error("System Error: No doctor associated.");let t=await m.searchPatients(o,e);i(t.data)}catch(e){console.error(e),u.Ay.error("Search failed"),i([])}finally{x(!1)}}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Search Patient"}),(0,a.jsxs)("form",{onSubmit:h,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"Enter Phone Number or Patient ID",className:"flex-1 rounded-md border-gray-300 border p-2 focus:ring-blue-500 focus:border-blue-500"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700 disabled:opacity-50",children:c?"Searching...":"Search"})]}),p&&(0,a.jsx)("div",{className:"mt-4",children:0===d.length?(0,a.jsx)("p",{className:"text-gray-500 text-center",children:"No patients found."}):(0,a.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer",onClick:()=>t(e),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",e.patientId," | \uD83D\uDCDE ",e.phone]})]}),(0,a.jsx)("button",{className:"text-sm bg-blue-50 text-blue-600 px-3 py-1 rounded hover:bg-blue-100",children:"Select"})]},e._id))})})]})}function h(e){let{queue:t,setQueue:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Today's Queue"}),(0,a.jsx)("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:t.length})]}),0===t.length?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No appointments for today yet."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SN"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{var t,s,r;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900",children:["#",e.serialNumber]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null==(t=e.patientId)?void 0:t.name)||"Unknown"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:null==(s=e.patientId)?void 0:s.phone})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(r=e.status,(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({waiting:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[r]||"bg-gray-100"),children:r.replace("_"," ").toUpperCase()}))}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:"paid"===e.paymentStatus?(0,a.jsx)("span",{className:"text-green-600 font-medium",children:"✓ Paid"}):(0,a.jsx)("span",{className:"text-orange-500 font-medium",children:"Pending"})})]},e._id)})})]})})]})}function b(e){let{patient:t,onCancel:s,onSuccess:l}=e,{user:d}=(0,n.n)(),[i,c]=(0,r.useState)(!1),m="new"===t.patientType,x=m?t.newPatientFee||500:t.oldPatientFee||300,[p,g]=(0,r.useState)({feeAmount:x,bookingType:"walk-in",paymentStatus:"pending"}),h=async e=>{e.preventDefault(),c(!0);try{let e=(null==d?void 0:d.role)==="doctor"?d.id:null==d?void 0:d.doctorId,s={patientId:t._id,doctorId:e,appointmentDate:new Date().toISOString(),bookingType:p.bookingType,feeAmount:p.feeAmount,feeType:m?"new_patient":"old_patient",paymentMethod:"cash",paymentStatus:p.paymentStatus};await o.P.createAppointment(s),u.Ay.success("Appointment booked successfully!"),l()}catch(e){var s,a;u.Ay.error((null==(a=e.response)||null==(s=a.data)?void 0:s.message)||"Booking failed")}finally{c(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Book Appointment"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-4 bg-blue-50 p-3 rounded text-sm text-blue-800",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Patient:"})," ",t.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"ID:"})," ",t.patientId]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Type:"})," ",t.patientType.toUpperCase()]})]}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Consultation Fee (Cash)"}),(0,a.jsx)("input",{type:"number",value:p.feeAmount,onChange:e=>g({...p,feeAmount:Number(e.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 border p-2 bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Status"}),(0,a.jsxs)("select",{value:p.paymentStatus,onChange:e=>g({...p,paymentStatus:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 border p-2",children:[(0,a.jsx)("option",{value:"pending",children:"Pay Later (Pending)"}),(0,a.jsx)("option",{value:"paid",children:"Paid Now"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:i,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400",children:i?"Booking...":"Confirm & Book"})]})]})]})})}var y=s(9829);function f(){let{user:e}=(0,n.n)(),[t,s]=(0,r.useState)([]),[l,d]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1),[m,x]=(0,r.useState)(0);(0,r.useEffect)(()=>{(async()=>{if(!e)return;let t="doctor"===e.role?e.id:e.doctorId;if(t)try{let e=await o.P.getTodayQueue(t);s(e.data)}catch(e){console.error("Failed to fetch queue",e)}})()},[e,m]),(0,r.useEffect)(()=>{if(!e)return;let t="doctor"===e.role?e.id:e.doctorId;if(!t)return;let s=(0,y.io)("http://localhost:5000");return s.on("connect",()=>{console.log("Connected to socket server"),"assistant"===e.role?s.emit("join-assistant-room",t):"doctor"===e.role&&s.emit("join-doctor-room",t)}),s.on("queue-update",e=>{if(console.log("Queue update received:",e),x(e=>e+1),"NEW_APPOINTMENT"===e.type){var t;u.Ay.success("New appointment: #".concat(null==(t=e.appointment)?void 0:t.serialNumber))}}),()=>{s.disconnect()}},[e]);let f=e=>{d(e),c(!0)};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-8",children:"Assistant Dashboard"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-8",children:[(0,a.jsx)(g,{onSelect:f}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center",children:(0,a.jsx)("span",{className:"px-2 bg-gray-50 text-sm text-gray-500",children:"OR"})})]}),(0,a.jsx)(p,{onSuccess:e=>{f(e)}})]}),(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)(h,{queue:t,setQueue:s})})]}),i&&l&&(0,a.jsx)(b,{patient:l,onCancel:()=>c(!1),onSuccess:()=>{c(!1),d(null),x(e=>e+1)}})]})}},7450:(e,t,s)=>{Promise.resolve().then(s.bind(s,6560))},7621:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let a=s(5125).A.create({baseURL:"http://localhost:50001/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("token")||sessionStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{if(e.response)switch(e.response.status){case 401:localStorage.removeItem("token"),sessionStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/auth/login";break;case 403:console.error("Access denied:",e.response.data);break;case 404:console.error("Resource not found");break;case 500:console.error("Server error:",e.response.data);break;default:console.error("API Error:",e.response.data)}else e.request?console.error("Network error - no response received"):console.error("Error:",e.message);return Promise.reject(e)});let r=a}},e=>{e.O(0,[663,125,342,173,441,493,358],()=>e(e.s=7450)),_N_E=e.O()}]);